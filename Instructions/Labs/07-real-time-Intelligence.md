---
lab:
  title: Microsoft Fabric 中的实时智能入门
  module: Get started with Real-Time Intelligence in Microsoft Fabric
---

# Microsoft Fabric 中的实时智能入门

Microsoft Fabric 提供了一个实时中心，可以在其中为实时数据流创建分析解决方案。 在本练习中，你将探索 Microsoft Fabric 中实时智能功能的一些主要特性，以便熟悉它们。

完成本实验室大约需要 30 分钟。

> **备注**：你需要 [Microsoft Fabric 租户](https://learn.microsoft.com/fabric/get-started/fabric-trial)才能完成本练习。

## 创建工作区

在 Fabric 中处理数据之前，需要创建一个已启用 Fabric 容量的工作区。

1. 在 [Microsoft Fabric 主页](https://app.fabric.microsoft.com/home?experience=fabric) (`https://app.fabric.microsoft.com/home?experience=fabric`) 上，选择“**实时智能**”。
1. 在左侧菜单栏中，选择“工作区”（图标类似于 &#128455;）。
1. 新建一个工作区并为其指定名称，并选择包含 Fabric 容量（试用版、高级版或 Fabric）的许可模式  。
1. 打开新工作区时，它应为空。

    ![Fabric 中空工作区的屏幕截图。](./Images/new-workspace.png)

## 创建 Eventhouse

现在，你已拥有工作区，可以开始创建实时智能解决方案所需的 Fabric 项。 我们将首先创建一个事件屋，其中包含用于实时数据的 KQL 数据库。

1. 在左侧菜单栏上，选择“**开始**”；然后在“实时智能”主页中，创建新的“**Eventhouse**”，为其指定所选的唯一名称。
1. 关闭显示的所有建议或提示，直到看到新的空事件屋。

    ![新事件屋的屏幕截图](./Images/create-eventhouse.png)

1. 在左侧窗格中，请注意事件屋包含一个与事件屋同名的 KQL 数据库。 可以在此数据库中为实时数据创建表，或根据需要创建其他数据库。
1. 选择数据库，注意有一个相关的*查询集*。 此文件包含一些可用于开始查询数据库中表的示例 KQL 查询。

    但是，目前没有要查询的表。 让我们通过使用事件流将一些数据引入数据库来解决该问题。

## 创建事件流

1. 在 KQL 数据库的主页中，选择“**获取数据**”。
2. 对于数据源，请选择“**Eventstream**” > “**新建 Eventstream**”。 将 Eventstream 命名为 `stock-stream`。

    新事件流的创建只需片刻即可完成。 建立之后，你将自动重定向到主编辑器，准备好开始将源集成到 Eventstream 中。

    ![创建新事件流的屏幕截图。](./Images//name-eventstream.png)

1. 在事件流画布中，选择“**使用示例数据**”。
1. 将源命名为 `Stock`，然后选择“**股票市场**”示例数据。

    流将被映射，并且会自动显示在**事件流画布**上。

   ![事件流画布的屏幕截图。](./Images/new-stock-stream.png)

1. 在“**转换事件或添加目标**”下拉列表的“**目标**”部分中，选择“**Eventhouse**”。
1. 在“**Eventhouse**”窗格中，配置以下设置选项。
   - **数据引入模式：** 引入前的事件处理
   - **目标名称：**`stock-table`
   - **工作区：***选择在本练习开始时创建的工作区*
   - **Eventhouse**：*选择事件屋*
   - **KQL 数据库：***选择事件屋 KQL 数据库*
   - **目标表：** 创建名为 `stock` 的新表
   - **输入数据格式：** JSON

   ![具有引入模式的 KQL 数据库事件流](./Images/configure-destination.png)

1. 在“**Eventhouse**”窗格中，选择“**保存**”。
1. 在工具栏上，选择“发布”****。
1. 等待一分钟左右，让数据目标变为活动状态。

    在本练习中，你创建了一个非常简单的事件流，可以捕获实时数据并将其加载到表中。 在实际解决方案中，通常会添加转换以在时间窗口内聚合数据（例如，捕获五分钟内每只股票的平均价格）。

    现在，让我们探讨如何查询和分析捕获的数据。

## 查询捕获的数据

事件流捕获实时股票市场数据，并将其加载到 KQL 数据库的表中。 可以查询此表以查看捕获的数据。

1. 在左侧菜单栏中，选择事件屋数据库。
1. 选择数据库的*查询集*。
1. 在查询窗格中，修改第一个示例查询，如下所示：

    ```kql
    stock
    | take 100
    ```

1. 选择查询代码并运行，以查看表中的 100 行数据。

    ![KQL 查询的屏幕截图。](./Images/kql-stock-query.png)

1. 查看结果，然后修改查询以检索过去 5 分钟内每个股票代码的平均价格：

    ```kql
    stock
    | where ["time"] > ago(5m)
    | summarize avgPrice = avg(todecimal(bidPrice)) by symbol
    | project symbol, avgPrice
    ```

1. 突出显示修改后的查询并运行，以查看结果。
1. 等待几秒钟后再次运行，注意随着新数据从实时流添加到表中，平均价格会发生变化。

## 创建实时仪表板

现在，你已有一个通过数据流填充的表，可以使用实时仪表板来可视化数据。

1. 在查询编辑器中，选择用于检索过去五分钟平均股票价格的 KQL 查询。
1. 在工具栏上，选择“**固定到仪表板**”。 然后将查询固定**在新仪表板中**，设置如下：
    - **仪表板名称**：`Stock Dashboard`
    - **磁贴名称**：`Average Prices`
1. 创建并打开仪表板。 它看起来应该如下所示：

    ![新仪表板的屏幕截图。](./Images/stock-dashboard-table.png)

1. 在仪表板顶部，从“**查看**”模式切换到“**编辑**”模式。
1. 选择“**平均价格**”磁贴的“**编辑**”（*铅笔*）图标。
1. 在“**视觉对象格式**”窗格中，将“**视觉对象**”从“*表格*”更改为“*柱形图*”：

    ![正在编辑的仪表板磁贴的屏幕截图。](./Images/edit-dashboard-tile.png)

1. 在仪表板顶部，选择“**应用更改**”并查看修改后的仪表板：

    ![带有图表磁贴的仪表板的屏幕截图。](./Images/stock-dashboard-chart.png)

    现在，你已拥有实时股票数据的实时可视化效果。

## 创建警报

Microsoft Fabric 中的实时智能包括一项名为“*Activator*”的技术，它可以根据实时事件触发操作。 当平均股票价格上涨特定值时，让我们用它来提醒你。

1. 在包含股票价格可视化效果的仪表板窗口中，在工具栏中选择“**设置警报**”。
1. 在“**设置警报**”窗格中，使用以下设置创建警报：
    - **运行查询频率**：每 5 分钟
    - **检查**：按以下方式分组的每个事件
    - **分组字段**：符号
    - **时间**：avgPrice
    - **条件**：上涨了
    - **值**：100
    - **操作**：给我发送电子邮件
    - **保存位置**：
        - **工作区**：*你的工作区*
        - **项**：创建新项
        - **新项名称**：*所选的唯一名称*

    ![警报设置的屏幕截图。](./Images/configure-activator.png)

1. 创建警报并等待其保存。 然后关闭确认已创建的窗格。
1. 在左侧菜单栏中，选择工作区的页面（如果出现提示，请将任何未保存的更改保存到仪表板）。
1. 在工作区页面上，查看在本练习中创建的项目，包括警报的激活器。
1. 打开激活器，并在其页面的 **avgPrice** 节点下，选择提醒的唯一标识符。 然后查看其“**历史记录**”选项卡。

    提醒可能尚未触发，在这种情况下，历史记录将不包含任何数据。 如果股票平均价格变化超过 100，激活器将向你发送电子邮件，并且警报将记录在历史记录中。

## 清理资源

在本练习中，你创建了事件屋、使用事件流引入了实时数据、查询了 KQL 数据库表中的引入数据、创建了实时仪表板来可视化实时数据，并使用 Activator 配置了警报。

如果你已完成 Fabric 中的实时智能探索，可以删除为此练习创建的工作区。

1. 在左侧栏中，选择你的工作区的图标。
2. 在工具栏中，选择“**工作区设置**”。
3. 在“常规”部分中，选择“删除此工作区”。********
